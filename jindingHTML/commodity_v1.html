<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>商品列表</title>

    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">

    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <link rel="icon" type="image/png" href="i/favicon.png">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="i/app-icon72x72@2x.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <link rel="apple-touch-icon-precomposed" href="i/app-icon72x72@2x.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="i/app-icon72x72@2x.png">
    <meta name="msapplication-TileColor" content="#0e90d2">

    <!-- Amaze UI CSS -->
    <link rel="stylesheet" href="../assets/css/amazeui.css">
    <link rel="stylesheet" href="../assets/css/sl.css">
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/amazeui.js"></script>
    <script src="../assets/js/myFirst.js"></script>
    <style>
        div.am-tabs-bd button{
            /*border: 6px solid red;*/
            padding: 0.2rem 0.6rem;
            color: white;
            background-color: red;
            /*-webkit-border-radius: 2px;*/
            /*-moz-border-radius: 2px;*/
            /*border-radius: 0.8rem;*/
        }

        ::-webkit-scrollbar{
            width: 0.1rem;
        }

    </style>

</head>
<body >
<div class="top-div" style="width: 100%;position:fixed;top: 0px;left: 0px;z-index: 10001">
    <div class="sl-flex-row-center-flex-start " style="background-color: red;height: 3rem;padding-left: 0.8rem;">
        <img src="../assets/images/back.png" alt="" style="width: 1.5rem;height: 1.5rem;" onclick="goBack()">
        <div style="color: white;" class="title">福利清单</div>
    </div>
</div>
<div style="margin-top: 3.2rem;">
    <ul class="am-avg-sm-2" style="background-color: white;" id="list">
        <li data-fruit-type="0">
            <div class="sl-margin-04rem-04rem-04rem-08rem sl-border-1px-solid-D3D3D3">
                <div class="sl-background-color-F6F6F6 sl-flex-row-center-center sl-padding-1rem">
                    <img src="../assets/images/fruits/pg/0/slider/pg_2.jpg" alt="" style="width: 100%;height: 100%;">
                </div>
                <div class="sl-border">
                    <div class="am-text-truncate">智利嘎啦果6个115g以上/个</div>
                    <div class="sl-flex-row-center-space-between data-JF-KC">
                        <div class="sl-flex-row-center-flex-start">
                            <img src="../assets/images/money.png" alt="" style="width: 1rem;height: 1rem;">
                            <span style="color: red;">120</span>
                            <span> &nbsp;积分</span>
                        </div>
                        <div>
                            <span>库存:</span><b style="color: red;">100</b>
                        </div>
                    </div>
                    <div class="sl-flex-row-center-space-between">
                        <div style="font-size: .6rem;">
                            <span>由</span><b style="color: #44b549;">易批购商城</b><span>提供</span>
                        </div>
                        <div>
                            <button class="ls-button">兑换</button>
                        </div>
                    </div>
                </div>
            </div>
        </li>
        <li data-fruit-type="1">
            <div class="sl-margin-04rem-08rem-04rem-04rem sl-border-1px-solid-D3D3D3">
                <div class="sl-background-color-F6F6F6 sl-flex-row-center-center sl-padding-1rem">
                    <img src="../assets/images/fruits/gng/0/slider/gng_2.jpg" alt="" style="width: 100%;height: 100%;">
                </div>
                <div class="sl-border">
                    <div class="am-text-truncate">吉林长白山菇娘果500g</div>
                    <div class="sl-flex-row-center-space-between data-JF-KC">
                        <div class="sl-flex-row-center-flex-start">
                            <img src="../assets/images/money.png" alt="" style="width: 1rem;height: 1rem;">
                            <span style="color: red;">150</span>
                            <span> &nbsp;积分</span>
                        </div>
                        <div>
                            <span>库存:</span><b style="color: red;">60</b>
                        </div>
                    </div>
                    <div class="sl-flex-row-center-space-between">
                        <div style="font-size: .6rem;">
                            <span>由</span><b style="color: #44b549;">易批购商城</b><span>提供</span>
                        </div>
                        <div>
                            <button class="ls-button">兑换</button>
                        </div>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>
<div class="am-modal am-modal-prompt" tabindex="-1" id="my-prompt">
    <div class="am-modal-dialog">
        <div class="am-modal-hd" style="border-bottom: 1px solid #CACACA;">兑换信息</div>
        <div class="sl-flex-column-flex-start-center">
            <header class="sl-header">兑换方式：积分兑换</header>
            <div class="am-modal-bd ">
                <table>
                    <tr>
                        <td style="width: 40%;">您的积分</td>
                        <td style="width: 30%;">300</td>
                        <td style="width: 30%;">积分</td>
                    </tr>
                    <tr>
                        <td>兑换价格</td>
                        <td></td>
                        <td>积分</td>
                    </tr>
                    <tr>
                        <td>库存</td>
                        <td style="color: red;"><b></b></td>
                        <td>个</td>
                    </tr>
                    <tr>
                        <td>可兑换数</td>
                        <td style="color: red;"><b></b></td>
                        <td>个</td>
                    </tr>
                    <tr>
                        <td>数量</td>
                        <td colspan="2"><input type="number" oninput="checkVal(this)" class="am-modal-prompt-input"></td>
                    </tr>
                </table>
            </div>
            <header class="sl-header">兑换方式：兑换码兑换</header>
            <div class="am-modal-bd" style="width: 100%;">
                <table style="width: 100%;">
                    <tr>
                        <td style="width: 40%;"></td>
                        <td style="width: 30%;"></td>
                        <td style="width: 30%;"></td>
                    </tr>
                    <tr>
                        <td >兑换码</td>
                        <td colspan="2"><input type="number" class="am-modal-prompt-input" ></td>
                    </tr>
                </table>
            </div>
            <header class="sl-header">兑换方式：二维码兑换</header>
            <div class="am-modal-bd" style="width: 100%;">
                <table style="width: 100%;">
                    <tr>
                        <td style="width: 40%;"></td>
                        <td style="width: 30%;"></td>
                        <td style="width: 30%;"></td>
                    </tr>
                    <tr>
                        <td >兑换码</td>
                        <td colspan="2"><input type="number" class="am-modal-prompt-input" ></td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
            <span class="am-modal-btn" data-am-modal-confirm>提交</span>
        </div>
    </div>
</div>


<div class="sl-flex-column-center-center sl-width-percent100 sl-background-color-white sl-display-none" style="" id="translate">
    <div class="sl-flex-column-flex-start-center sl-border-bottom-1px-solid-D3D3D3 sl-padding-bottom-1rem" id="sl-head">
        <div class="sl-width-percent100 sl-flex-row-flex-end-flex-end">
            <div class="sl-width-1dot2rem sl-height-1dot2rem sl-margin-top-06rem sl-margin-right-06rem">
                <img src="../assets/images/关闭.png" alt="" class="sl-width-percent100 sl-height-percent100" style="vertical-align:top" onclick="hideTied()">
            </div>
        </div>

        <div class="sl-flex-column-flex-start-center">
            <div class="sl-flex-row-center-flex-start">
                <img src="../assets/images/money.png" alt="" style="width: 1rem;height: 1rem;">
                <span style="color: red;">120</span><span> &nbsp;积分</span>
            </div>
            <div class="sl-flex-row-center-center">
                <span>库存</span><b style="color: red;">100</b><span>件</span>
            </div>
            <div>
                <span>可兑换数</span><b style="color: red;">2</b><span>件</span>
            </div>
        </div>
    </div>

    <div class="am-modal-bd sl-flex-column-center-center">
        <div class="sl-flex-row-center-space-between" style="width: 100%;">
            <span>兑换数量</span>
            <div class="sl-flex-row-flex-end-flex-end">
                <div style="margin-right: 0.4rem;" class="sl-flex-row-center-center sl-width-2rem sl-height-2rem sl-background-color-F9F9FA" id="minus">
                    <img src="../assets/images/减.png" alt="" class="sl-width-percent50 sl-height-percent50">
                </div>
                <div style="" class="sl-width-2rem sl-height-2rem">
                    <input type="number" onblur="checkVal(this)" id="inputNum" value="1" id="valInput" class="sl-background-color-F4F4F4 am-modal-prompt-input sl-width-2rem sl-height-2rem" style="vertical-align: bottom;margin:0px;border: 0px;text-align: center;font-weight: bold;">
                </div>
                <div style="margin-left: 0.4rem" class="sl-flex-row-center-center sl-width-2rem sl-height-2rem sl-background-color-F4F4F4" id="add">
                    <img src="../assets/images/加.png" alt=""  class="sl-width-percent50 sl-height-percent50">
                </div>
            </div>
        </div>
    </div>





    <div style="text-align: center;" class="sl-margin-top-5rem sl-background-color-red sl-font-color-white sl-width-percent100 sl-padding-05rem" id="confirm">确定</div>
</div>
<div data-am-widget="navbar" class="am-navbar am-cf am-navbar-default " style="border-top: 2px solid #E5E5E5;">
    <ul class=" am-navbar-nav am-cf am-avg-sm-4 ">
        <li >
            <a href="#" class="">
                <img src="../assets/images/bottomNavClick/首页.png" alt="">
                <span class="am-navbar-label  sl-font-color-red">首页</span>
            </a>
        </li>
        <li >
            <a href="my.html" class="">
                <img src="../assets/images/bottomNav/我的.png" alt="">
                <span class="am-navbar-label sl-icon-color-6D6D6D">我的</span>
            </a>
        </li>
    </ul>
</div>
<!--灰色层-->
<div id="grayTier"></div>
<!--图片层-->
<!--<div id="imgTier" class="sl-background-color-yellow sl-width-6rem sl-height-6rem sl-display-none sl-flex-row-center-center">-->
    <div class="sl-padding-02rem sl-background-color-white sl-border-1px-solid-F4F4F4 sl-border-radius-08rem" id="imgTier">
        <img src="" alt="" class="sl-width-percent100 sl-height-percent100 ">
    </div>
<!--</div>-->






</body>
</html>
<script>
    //全局变量
    var rem = new Rem();
    var canBuyNum = 0;
    var KC = 0;
    var errorMsg = false;
    var wH = screen.height;
    var wW = screen.width;
    //回顶部
    $("#up").click(function () {
        $('html, body').animate({scrollTop: 0}, '500');
    })

    //排序
    $('ul.am-dropdown-content li').click(function () {
        $(this).addClass('am-active').siblings('li').removeClass('am-active');
    });


    //点击商品列表
    $("#list li").mousedown(function (e) {
        var cX = e.pageX;//鼠标对象相对于文档对象的左边缘的位置

        var cY = e.pageY;//鼠标对象相对于文档对象的顶部边缘的位置
        var $b = $(this).find('button')
        var bW = $b.outerWidth();
        var bH = $b.outerHeight();
        var bX = $b.offset().left;//元素对象相对于文档对象的左边缘的位置
        var bY = $b.offset().top;//元素对象相对于文档对象的顶部边缘的位置
        //积分信息
        var price = $(this).find('div.data-JF-KC').find('span:eq(0)').html();
        KC = $(this).find('div.data-JF-KC').find('b').html();
        var yourJF = 1000;
        canBuyNum =  parseInt(yourJF / price);

        if (cX >= bX && cX <= bX + bW && cY >= bY && cY <= bY + bH) {
            var $img = $(this).children('div:eq(0)').children('div:eq(0)').find('img');
            var s = $img.attr('src');
            var $iT = $('#imgTier').find('img');
            $iT.attr('src', s);
            var itH = $('#imgTier').outerHeight();
            var dH = $('#translate').outerHeight();

            var divArr= $('#sl-head').children('div:eq(1)').children('div');
            divArr.eq(0).find('span:eq(0)').html(price);
            divArr.eq(1).find('b:eq(0)').html(KC);
            divArr.eq(2).find('b:eq(0)').html(parseInt(yourJF / price));

            $('#grayTier').show();
            $('#translate').animate({
                bottom: 0
            }, 300);
            $('#imgTier').animate({
                bottom: dH -  itH / 6 * 5
            }, 300);
        } else {
            console.log("P:" + price + "KC:" + KC);
            sessionStorage.setItem('yourJF', yourJF);
            sessionStorage.setItem('price', price);
            sessionStorage.setItem('KC', KC);
            var t = $(this).data('fruitType');
            location.href = 'commodityDetail.html'
        }
    })
    //标题文字居中
    $(function () {
        rem.titleCenter();
    });
    //退回
    function goBack() {
        history.back();
    };

    //将商品信息隐藏
    $(function () {
        $("#translate").css({
            position: 'fixed',
            bottom: -($("#translate").outerHeight() + $("#imgTier").outerHeight()/8),
            left: 0,
            zIndex: 10005,
            display: 'block'
        })

        var  l= $('#sl-head').height();
        var h = l * 7 / 6;
        $("#imgTier").css({
            position: 'fixed',
            bottom: -h,
            left: h/12,
            zIndex: 10007,
            width:  h,
            height: h,
            display: 'block'
        });
        $('#sl-head').children('div:eq(1)').css('margin-left', h+h/6);


    });

    //灰色一层
    $(function () {
        var wW = screen.width;
        $('#grayTier').css({
            position: 'fixed',
            top: 0,
            left: 0,
            width: wW,
            height: wH,
            backgroundColor: '#A5A4A5',
            zIndex: 10002,
            display: 'none',
            opacity: 0.5
        })
    });
    //点击确定
    $("#confirm").click(function () {
        if(errorMsg){
            errorMsg = false;
        }else{
            $('#valInput').trigger('blur');
            if(!errorMsg){
                hideTied();
            }

        }
    });
    //点击灰色层隐藏
    $('#grayTier').on('click',function () {
        hideTied();
    }) ;
    //隐藏灰色层和商品信息层
    function hideTied() {
        $('#grayTier').hide();
        var $iH = $('#imgTier').outerHeight();
        $('#translate').animate({
            bottom: -($("#translate").outerHeight() + $("#imgTier").outerHeight()/5),
        },500);
        $('#imgTier').animate({
            bottom: -$("#imgTier").outerHeight(),
        },500);
    }
    //点击减按钮
    $("#minus").click(function () {
        var $input=  $(this).next().find('input');
        var v = $input.val();
        var f = rem.inputVal($input);
        if(typeof f === 'boolean' && f == true){
            var n  = parseInt($.trim(v)) -1;
            if(n > 1){
                $input.val(n);
            }else{
                $input.val(1);
                $("#minus").removeClass('sl-background-color-F4F4F4').addClass('sl-background-color-F9F9FA');
            }
        }
    });
    //加按钮
    $("#add").click(function () {
        var $input=  $(this).prev().find('input');
        var v = $input.val();
        var f = rem.inputVal($input);
        if(typeof f === 'boolean' && f == true){
            console.log('v:'+ parseInt($.trim(v)));
            var n  = parseInt($.trim(v)) + 1;
            console.log("n:"+n+",canBuyNum"+canBuyNum+',KC'+KC);
            if(n > 1){
                $("#minus").removeClass('sl-background-color-F9F9FA').addClass('sl-background-color-F4F4F4')
            }
            if(canBuyNum > KC){
                if(n > KC){
                    rem.alertInfoImgByState('库存不足',1);
                    $input.val(KC);
                }else{
                    $input.val(n);
                }
            }else{
                if(n > canBuyNum){
                    rem.alertInfoImgByState('积分不足',1);
                    $input.val(canBuyNum);
                }else{
                    $input.val(n);
                }
            }
        }
    });
    //    时时刻刻检查输入框中的值
    function checkVal(self) {
        var n = parseInt($(self).val());
        if(isNaN(n) || n <= 0  ){
            rem.alertInfoImgByState('请输入正整数',1);
            errorMsg = true;
            $(self).val(1);
            $("#minus").removeClass('sl-background-color-F4F4F4').addClass('sl-background-color-F9F9FA');
        }else{
            errorMsg = false;
        }
        if(canBuyNum > KC){
            if( n > KC ){
                rem.alertInfoImgByState('库存不足',1);
                errorMsg = true;
                $(self).val(KC);
                if(KC > 1){
                    $("#minus").removeClass('sl-background-color-F9F9FA').addClass('sl-background-color-F4F4F4')
                }else {
                    $("#minus").removeClass('sl-background-color-F4F4F4').addClass('sl-background-color-F9F9FA');
                }
            }else{
                errorMsg = false;
            }
        }else{
            if( n > canBuyNum ){
                rem.alertInfoImgByState('积分不足',1);
                errorMsg = true;
                $(self).val(canBuyNum);
                if(canBuyNum > 1){
                    $("#minus").removeClass('sl-background-color-F9F9FA').addClass('sl-background-color-F4F4F4')
                }else {
                    $("#minus").removeClass('sl-background-color-F4F4F4').addClass('sl-background-color-F9F9FA');
                }
            }else{
                errorMsg = false;
            }
        }
        if(n == 1){
            $("#minus").removeClass('sl-background-color-F4F4F4').addClass('sl-background-color-F9F9FA');
        }
    }
</script>